; presa da
; https://www.youtube.com/watch?v=HvRG91yWNCQ
; la versione originale ha i pollici e non i mm

o<touch_plate> sub

#<fresino> = #1(= 0 nÂ° fresino)
#<vel_ingresso> = #<_feed> ; salva la velocita attuale

; G10 L2 X-83 Y83 Z0 ; imposta le coordinate di G59.3, posizione
; touchplate conviene usare uno Z0, uguale alle coordinate G53 in modo
; da avere la misura assoluta di spostamento

; G30 parameters will be used to move the tool when a M6 is programmed
; if TOOL_CHANGE_AT_G30=1 is in the [EMCIO] section of the ini file.

; G53 G0 Z19                 ; si alza al max Z
; G53 G0 Z10 su dbox 
G53 G0 X-83 Y83            ; si sposta in angolo alto sinistra
T#1 M6                     ; pausa per cambio utensile
; 
G91                        ; coordinate relative
G38.2 Z-35 F200            ; MAX giu 37? scendi veloce per toccare approssimativamente
G1 Z0.5                    ; torna su di mezzo mm
G38.2 Z-1 F5               ; scendi piano per toccare precisamente
G90                        ; coordinate assolute
; https://forum.linuxcnc.org/49-basic-configuration/32160-tool-length-offset-setup-question
; https://forum.linuxcnc.org/21-axis/2653-tool-length-offsets-in-emc
; https://forum.linuxcnc.org/22-pyvcp/28826-spinbox-data-to-g-code-variable
;G43 H#1                   ; PROVARE A INSERIRE COMPENSAZIONE Z DALLA TOOL TABLE
G10 L20 P1 Z-8.9119        ; contatto per Z mandrino (G54 = P1)
; G59.3                    ; dovrebbe diventare il punto fisso del touchplate
G10 L10 P#1 Z#<_z>         ; G10 L10 e non so come dargli la zeta
; G10 P#1 L1 Z#<_z>        ; G10 L1 scrive i parametri dentro la tooltable
G43 H#1                    ; carica gli offset appena modificati, legge la tool table
G53 G0 Z19                 ; torna su di 20 mm
                        ; coordinate assolute
F#<vel_ingresso>           ; ripristina velocita ingresso

;G91 ; coordinate relative dbox
;G38.2 Z-27 F200 ; MAX giu 27scendi veloce per toccare approssimativamente dbox
;G1 Z0.5 F200; torna su di mezzo mm dbox
;G38.2 Z-1 F5 ; scendi piano per toccare precisamente dbox
;G10 L20 P1 Z-8.9119 dbox
;G1 Z10 F300 ; torna su di 10 mm dbox
;G90 dbox
; versione 1 con zero manuale

;F10 G1 Z0 ; giu allo zero vero -0.1 su + 0.08 (20/10 mm) spessore
              ; del touchplate
;G90 ; coordinate assolute

; versione 2
; G90
; G38.2 Z-1 F1
; G10 L20 P0 Z0.1230
; G0 Z0.5

; versione 3
; G90
; G38.2 Z-1 F1
; G92 Z0.1230
; G0 Z0.5


o<touch_plate> endsub
